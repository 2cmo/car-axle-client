import { moduleDefinition } from '../../moduleapi'

function is_hidden(event: Event): boolean {

    if (!(event.target instanceof HTMLElement) || event.target.tagName.toLowerCase() !== "iframe") {
        if (document.hidden) return true;
    }

    return false
}

function destroy(event: Event) {
    if (!is_hidden(event)) return
    document.getElementById('cac__CONTAINER')?.remove()
}

function selfDestruct() {
    window.addEventListener('visibilitychange', (e) => destroy(e))
}

const plugin: moduleDefinition = {
    display_name: 'Auto Self Destruct',
    description: 'Automatically destroys the client when the window/tab changes',
    id: 'selfdestructalttab',
    section: 'exploit',
    onactive: selfDestruct,
    always: true,
    custom_render: false,
}

export default plugin
