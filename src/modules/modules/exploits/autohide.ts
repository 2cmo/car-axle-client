import { moduleDefinition } from '../../moduleapi'

const hideEvent = new KeyboardEvent('keydown', {
    key: '\\',
})

function is_hidden(event: Event): boolean {
    if (
        !(event.target instanceof HTMLElement) ||
        event.target.tagName.toLowerCase() !== 'iframe'
    ) {
        if (document.hidden) return true
    }
    return false
}

function hide(event: Event): void {
    if (
        !is_hidden(event) &&
        document.getElementById('cac__CONTAINER')?.style.display !== 'none'
    ) {
        document.dispatchEvent(hideEvent)
    }
}

function waittohide() {
    document.addEventListener('visibilitychange', (e) => hide(e))
}

const plugin: moduleDefinition = {
    display_name: 'Auto Hide',
    description:
        'Automatically hides UI when the tab/window changes (press "\\" to unhide once hidden)',
    id: 'autohide',
    section: 'exploit',
    onactive: waittohide,
    always: true,
    custom_render: false,
}

export default plugin
